<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>MTF Token Ico</title>

    <script language="javascript" type="text/javascript" src="web3.min.js"></script>

    <script type="text/javascript" src="https://cdn.emailjs.com/dist/email.min.js"></script>
    <script type="text/javascript">
       (function(){
          emailjs.init("user_JYU4jmVpfmsayHCPdA7Hz");
       })();
    </script>


</head>
<body>
    <div>

        <h1>MTF Token Ico</h1>

    </div>

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>

    <script>

       web3 = new Web3(new Web3.providers.WebsocketProvider("wss://ropsten.infura.io/ws"));

       // TODO : Update the ABI as per the updated contract
       var MintFlintABI = ([
    	{
    		"anonymous": false,
    		"inputs": [
    			{
    				"indexed": true,
    				"name": "from",
    				"type": "address"
    			},
    			{
    				"indexed": true,
    				"name": "to",
    				"type": "address"
    			},
    			{
    				"indexed": false,
    				"name": "value",
    				"type": "uint256"
    			}
    		],
    		"name": "Transfer",
    		"type": "event"
    	},
    	{
    		"constant": false,
    		"inputs": [
    			{
    				"name": "_spender",
    				"type": "address"
    			},
    			{
    				"name": "_value",
    				"type": "uint256"
    			}
    		],
    		"name": "approve",
    		"outputs": [
    			{
    				"name": "",
    				"type": "bool"
    			}
    		],
    		"payable": false,
    		"stateMutability": "nonpayable",
    		"type": "function"
    	},
    	{
    		"constant": false,
    		"inputs": [
    			{
    				"name": "_spender",
    				"type": "address"
    			},
    			{
    				"name": "_subtractedValue",
    				"type": "uint256"
    			}
    		],
    		"name": "decreaseApproval",
    		"outputs": [
    			{
    				"name": "",
    				"type": "bool"
    			}
    		],
    		"payable": false,
    		"stateMutability": "nonpayable",
    		"type": "function"
    	},
    	{
    		"constant": false,
    		"inputs": [],
    		"name": "drain",
    		"outputs": [],
    		"payable": false,
    		"stateMutability": "nonpayable",
    		"type": "function"
    	},
    	{
    		"constant": false,
    		"inputs": [
    			{
    				"name": "_spender",
    				"type": "address"
    			},
    			{
    				"name": "_addedValue",
    				"type": "uint256"
    			}
    		],
    		"name": "increaseApproval",
    		"outputs": [
    			{
    				"name": "",
    				"type": "bool"
    			}
    		],
    		"payable": false,
    		"stateMutability": "nonpayable",
    		"type": "function"
    	},
    	{
    		"constant": false,
    		"inputs": [],
    		"name": "pauseSale",
    		"outputs": [],
    		"payable": false,
    		"stateMutability": "nonpayable",
    		"type": "function"
    	},
    	{
    		"constant": false,
    		"inputs": [],
    		"name": "refund",
    		"outputs": [],
    		"payable": false,
    		"stateMutability": "nonpayable",
    		"type": "function"
    	},
    	{
    		"constant": false,
    		"inputs": [],
    		"name": "resumeSale",
    		"outputs": [],
    		"payable": false,
    		"stateMutability": "nonpayable",
    		"type": "function"
    	},
    	{
    		"constant": false,
    		"inputs": [],
    		"name": "teamAllocation",
    		"outputs": [],
    		"payable": false,
    		"stateMutability": "nonpayable",
    		"type": "function"
    	},
    	{
    		"anonymous": false,
    		"inputs": [
    			{
    				"indexed": true,
    				"name": "owner",
    				"type": "address"
    			},
    			{
    				"indexed": true,
    				"name": "spender",
    				"type": "address"
    			},
    			{
    				"indexed": false,
    				"name": "value",
    				"type": "uint256"
    			}
    		],
    		"name": "Approval",
    		"type": "event"
    	},
    	{
    		"anonymous": false,
    		"inputs": [],
    		"name": "MintFinished",
    		"type": "event"
    	},
    	{
    		"anonymous": false,
    		"inputs": [
    			{
    				"indexed": true,
    				"name": "to",
    				"type": "address"
    			},
    			{
    				"indexed": false,
    				"name": "amount",
    				"type": "uint256"
    			}
    		],
    		"name": "Mint",
    		"type": "event"
    	},
    	{
    		"anonymous": false,
    		"inputs": [
    			{
    				"indexed": false,
    				"name": "",
    				"type": "bool"
    			}
    		],
    		"name": "StateChanged",
    		"type": "event"
    	},
    	{
    		"anonymous": false,
    		"inputs": [
    			{
    				"indexed": true,
    				"name": "beneficiary",
    				"type": "address"
    			},
    			{
    				"indexed": false,
    				"name": "value",
    				"type": "uint256"
    			},
    			{
    				"indexed": false,
    				"name": "amount",
    				"type": "uint256"
    			}
    		],
    		"name": "TokenPurchase",
    		"type": "event"
    	},
    	{
    		"anonymous": false,
    		"inputs": [
    			{
    				"indexed": true,
    				"name": "previousOwner",
    				"type": "address"
    			},
    			{
    				"indexed": true,
    				"name": "newOwner",
    				"type": "address"
    			}
    		],
    		"name": "OwnershipTransferred",
    		"type": "event"
    	},
    	{
    		"constant": false,
    		"inputs": [
    			{
    				"name": "_to",
    				"type": "address"
    			},
    			{
    				"name": "_value",
    				"type": "uint256"
    			}
    		],
    		"name": "transfer",
    		"outputs": [
    			{
    				"name": "_success",
    				"type": "bool"
    			}
    		],
    		"payable": false,
    		"stateMutability": "nonpayable",
    		"type": "function"
    	},
    	{
    		"constant": false,
    		"inputs": [
    			{
    				"name": "_from",
    				"type": "address"
    			},
    			{
    				"name": "_to",
    				"type": "address"
    			},
    			{
    				"name": "_value",
    				"type": "uint256"
    			}
    		],
    		"name": "transferFrom",
    		"outputs": [
    			{
    				"name": "",
    				"type": "bool"
    			}
    		],
    		"payable": false,
    		"stateMutability": "nonpayable",
    		"type": "function"
    	},
    	{
    		"constant": false,
    		"inputs": [
    			{
    				"name": "newOwner",
    				"type": "address"
    			}
    		],
    		"name": "transferOwnership",
    		"outputs": [],
    		"payable": false,
    		"stateMutability": "nonpayable",
    		"type": "function"
    	},
    	{
    		"inputs": [
    			{
    				"name": "_startTime",
    				"type": "uint256"
    			},
    			{
    				"name": "_endTime",
    				"type": "uint256"
    			}
    		],
    		"payable": false,
    		"stateMutability": "nonpayable",
    		"type": "constructor"
    	},
    	{
    		"payable": true,
    		"stateMutability": "payable",
    		"type": "fallback"
    	},
    	{
    		"constant": true,
    		"inputs": [
    			{
    				"name": "_owner",
    				"type": "address"
    			},
    			{
    				"name": "_spender",
    				"type": "address"
    			}
    		],
    		"name": "allowance",
    		"outputs": [
    			{
    				"name": "",
    				"type": "uint256"
    			}
    		],
    		"payable": false,
    		"stateMutability": "view",
    		"type": "function"
    	},
    	{
    		"constant": true,
    		"inputs": [
    			{
    				"name": "_owner",
    				"type": "address"
    			}
    		],
    		"name": "balanceOf",
    		"outputs": [
    			{
    				"name": "",
    				"type": "uint256"
    			}
    		],
    		"payable": false,
    		"stateMutability": "view",
    		"type": "function"
    	},
    	{
    		"constant": true,
    		"inputs": [],
    		"name": "decimals",
    		"outputs": [
    			{
    				"name": "",
    				"type": "uint8"
    			}
    		],
    		"payable": false,
    		"stateMutability": "view",
    		"type": "function"
    	},
    	{
    		"constant": true,
    		"inputs": [],
    		"name": "endTime",
    		"outputs": [
    			{
    				"name": "",
    				"type": "uint256"
    			}
    		],
    		"payable": false,
    		"stateMutability": "view",
    		"type": "function"
    	},
    	{
    		"constant": true,
    		"inputs": [],
    		"name": "getPrice",
    		"outputs": [
    			{
    				"name": "",
    				"type": "uint256"
    			}
    		],
    		"payable": false,
    		"stateMutability": "pure",
    		"type": "function"
    	},
    	{
    		"constant": true,
    		"inputs": [],
    		"name": "maxCap",
    		"outputs": [
    			{
    				"name": "",
    				"type": "uint256"
    			}
    		],
    		"payable": false,
    		"stateMutability": "view",
    		"type": "function"
    	},
    	{
    		"constant": true,
    		"inputs": [],
    		"name": "mintingFinished",
    		"outputs": [
    			{
    				"name": "",
    				"type": "bool"
    			}
    		],
    		"payable": false,
    		"stateMutability": "view",
    		"type": "function"
    	},
    	{
    		"constant": true,
    		"inputs": [],
    		"name": "name",
    		"outputs": [
    			{
    				"name": "",
    				"type": "string"
    			}
    		],
    		"payable": false,
    		"stateMutability": "view",
    		"type": "function"
    	},
    	{
    		"constant": true,
    		"inputs": [],
    		"name": "owner",
    		"outputs": [
    			{
    				"name": "",
    				"type": "address"
    			}
    		],
    		"payable": false,
    		"stateMutability": "view",
    		"type": "function"
    	},
    	{
    		"constant": true,
    		"inputs": [],
    		"name": "paused",
    		"outputs": [
    			{
    				"name": "",
    				"type": "bool"
    			}
    		],
    		"payable": false,
    		"stateMutability": "view",
    		"type": "function"
    	},
    	{
    		"constant": true,
    		"inputs": [],
    		"name": "softCap",
    		"outputs": [
    			{
    				"name": "",
    				"type": "uint256"
    			}
    		],
    		"payable": false,
    		"stateMutability": "view",
    		"type": "function"
    	},
    	{
    		"constant": true,
    		"inputs": [],
    		"name": "softCapReached",
    		"outputs": [
    			{
    				"name": "",
    				"type": "bool"
    			}
    		],
    		"payable": false,
    		"stateMutability": "view",
    		"type": "function"
    	},
    	{
    		"constant": true,
    		"inputs": [],
    		"name": "startTime",
    		"outputs": [
    			{
    				"name": "",
    				"type": "uint256"
    			}
    		],
    		"payable": false,
    		"stateMutability": "view",
    		"type": "function"
    	},
    	{
    		"constant": true,
    		"inputs": [],
    		"name": "symbol",
    		"outputs": [
    			{
    				"name": "",
    				"type": "string"
    			}
    		],
    		"payable": false,
    		"stateMutability": "view",
    		"type": "function"
    	},
    	{
    		"constant": true,
    		"inputs": [],
    		"name": "totalSupply",
    		"outputs": [
    			{
    				"name": "",
    				"type": "uint256"
    			}
    		],
    		"payable": false,
    		"stateMutability": "view",
    		"type": "function"
    	},
    	{
    		"constant": true,
    		"inputs": [],
    		"name": "totalWeiReceived",
    		"outputs": [
    			{
    				"name": "",
    				"type": "uint256"
    			}
    		],
    		"payable": false,
    		"stateMutability": "view",
    		"type": "function"
    	},
    	{
    		"constant": true,
    		"inputs": [
    			{
    				"name": "",
    				"type": "address"
    			}
    		],
    		"name": "weiReceived",
    		"outputs": [
    			{
    				"name": "",
    				"type": "uint256"
    			}
    		],
    		"payable": false,
    		"stateMutability": "view",
    		"type": "function"
    	}
    ]);

       // TODO : Update the contract address
       var MintFlintContractAddress = "0x07b4762E1bc1A3a3ECFA42bD4349C45976A07Eae";
       MintFlint = new web3.eth.Contract(MintFlintABI, MintFlintContractAddress);
       console.log(MintFlint);

       // TODO : change emailjs credenatils
       MintFlint.events.StateChanged()
      .on("data", function(event) {
        let mintflint = event.returnValues;
        console.log("state has changed", mintflint.state);
      }).on("error", console.error);

      MintFlint.events.TokenPurchase()
     .on("data", function(event) {
       let mintflint = event.returnValues;
       console.log("Token purchase sucessfull", mintflint.beneficiary, mintflint.value, mintflint.amount);
       emailjs.send("gmail","test_email",{name: "test", notes: "Check this out!"})
      .then(function(response) {
         console.log("SUCCESS. status=%d, text=%s", response.status, response.text);
      }, function(err) {
         console.log("FAILED. error=", err);
      });
     }).on("error", console.error);

    // Get the public state varibale
    MintFlint.methods.name().call().then(console.log);

    // Get the public state varibale
    MintFlint.methods.owner().call().then(console.log);



    </script>

</body>
</html>
